<li id="micropost-<%= micropost.id %>">
  <% if micropost.user.avatar.attached? %>
    <%= image_tag micropost.user.avatar, size: "50x50" %>
  <% else %>
    <%= image_tag("hodr_logo.png", size: "50x50") %>
  <% end %>
  <span class="user"><%= link_to micropost.user.uname, micropost.user, class: 'post_user_link' %></span>
  <span class="content post_content">
    <%= micropost.content.gsub(/@(\w+)/) do |match|
          user = User.find_by(uname: $1)
          if user
            link_to match, user_path(user)
          else
            match
          end
        end.html_safe %>
  </span>
  <% if micropost.images.attached? %>
    <%= image_tag micropost.images.first, width: "100%" %>
    <% if micropost.images.count > 1 %>
      <div class="additional-images">
        <% micropost.images.drop(1).each do |image| %>
          <%= image_tag image.variant(resize_to_limit: [100, 100]), class: "small-image" %>
        <% end %>
      </div>
    <% end %>
  <% end %>


  <span class="timestamp post_time">
    Posted <%= time_ago_in_words(micropost.created_at) %> ago.
    <% if current_user?(micropost.user) %>
      <%= link_to "delete", micropost, data: { "turbo-method": :delete, turbo_confirm: "You sure?" }, class: 'delete_post_link' %>
    <% end %>
  </span>
  <%= render micropost.comments %>

  <%= form_with(model: [micropost, Comment.new], local: true) do |form| %>
    <%= form.text_area :content, placeholder: "Write a comment...", class: 'comment_text_area' %>
    <%= form.submit "Post Comment", class: 'comment_submit_button' %>
  <% end %>
</li>
